<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>System Setup - Apex Systems</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; 
            background: #f0f2f5; 
            font-family: 'Poppins', sans-serif; 
        }
        .login-box { 
            background: #fff; 
            padding: 50px; 
            border-radius: 20px; 
            width: 450px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); 
            text-align: center;
        }
        h2 { margin-bottom: 10px; color: #1f2937; }
        p { color: #6b7280; margin-bottom: 30px; font-size: 0.9rem; }
        label { display: block; text-align: left; margin-bottom: 5px; color: #6b7280; font-size: 0.9rem; font-weight: 500; }
        input { 
            width: 100%; padding: 12px; margin-bottom: 20px; 
            border: 1px solid #e5e7eb; border-radius: 10px; 
            background: #f9fafb; outline: none; transition: 0.2s;
        }
        input:focus { border-color: #10b981; background: #fff; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        button { 
            width: 100%; padding: 12px; 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            color: #fff; border: none; border-radius: 10px; 
            font-weight: 600; cursor: pointer; transition: 0.2s;
            font-size: 1rem;
        }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .logo { font-size: 3rem; color: #10b981; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>
    <div class="login-box">
        <span class="logo">ðŸš€</span>
        <h2>Welcome to Apex</h2>
        <p>No users found. Please create the <strong>System Administrator</strong> account to get started.</p>
        
        <form id="setup-form">
            <label>Admin Username</label>
            <input type="text" id="username" required placeholder="Admin">
            
            <label>Email Address</label>
            <input type="email" id="email" required placeholder="admin@apex.com">
            
            <label>Password</label>
            <input type="password" id="password" required placeholder="Create a strong password">
            
            <button type="submit">Create Admin Account</button>
        </form>
        <div id="alert" style="color: #ef4444; margin-top: 15px; font-size: 0.9rem;"></div>
    </div>
    <script>
        // Double check: If system is already set up, go to login
        fetch('/api/auth/setup-status')
            .then(res => res.json())
            .then(data => {
                if(data.isInitialized) window.location.href = '/login.html';
            });

        document.getElementById('setup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const res = await fetch('/api/auth/setup', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ username, email, password })
            });

            if(res.ok) {
                alert("Admin account created! Redirecting to login...");
                window.location.href = '/login.html';
            } else {
                const err = await res.json();
                document.getElementById('alert').innerText = err.error || "Setup failed.";
            }
        });
    </script>
</body>
</html>