<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Systems - Login</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS (same as before for theme) -->
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--apex-background);
        }
        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }
    </style>
</head>
<body>

<div class="card login-card shadow-lg">
    <h2 class="text-center apex-logo mb-4">
        ðŸ¦– Apex <span>Systems</span>
    </h2>

    <form id="login-form">
        <div class="mb-3">
            <label for="login-email" class="form-label text-light">Email address</label>
            <input type="email" class="form-control bg-dark text-light border-warning" id="login-email" required>
        </div>
        <div class="mb-4">
            <label for="login-password" class="form-label text-light">Password</label>
            <input type="password" class="form-control bg-dark text-light border-warning" id="login-password" required>
        </div>
        
        <div id="auth-alert" class="alert d-none" role="alert"></div>

        <button type="submit" class="btn btn-primary w-100">Login</button>
        
        <p class="mt-3 text-center text-muted">
            <a href="#" class="text-warning" id="show-register">Need an account? Register</a>
        </p>
    </form>
    
    <form id="register-form" class="d-none">
        <!-- Registration Fields (Username, Email, Password) -->
        <div class="mb-3">
            <label for="reg-username" class="form-label text-light">Username</label>
            <input type="text" class="form-control bg-dark text-light border-warning" id="reg-username" required>
        </div>
        <div class="mb-3">
            <label for="reg-email" class="form-label text-light">Email address</label>
            <input type="email" class="form-control bg-dark text-light border-warning" id="reg-email" required>
        </div>
        <div class="mb-4">
            <label for="reg-password" class="form-label text-light">Password</label>
            <input type="password" class="form-control bg-dark text-light border-warning" id="reg-password" required>
        </div>

        <div id="reg-alert" class="alert d-none" role="alert"></div>

        <button type="submit" class="btn btn-primary w-100">Register</button>
        
        <p class="mt-3 text-center text-muted">
            <a href="#" class="text-warning" id="show-login">Back to Login</a>
        </p>
    </form>
</div>

<!-- Application Logic for Auth -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterLink = document.getElementById('show-register');
        const showLoginLink = document.getElementById('show-login');
        const authAlert = document.getElementById('auth-alert');
        const regAlert = document.getElementById('reg-alert');

        // Toggle visibility between forms
        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('d-none');
            registerForm.classList.remove('d-none');
            authAlert.classList.add('d-none');
        });

        showLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.add('d-none');
            loginForm.classList.remove('d-none');
            regAlert.classList.add('d-none');
        });

        const showAlert = (alertElement, message, type) => {
            alertElement.textContent = message;
            alertElement.className = `alert mt-3 ${type === 'success' ? 'alert-success' : 'alert-danger'}`;
            alertElement.classList.remove('d-none');
        };

        // Handle Login Submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            authAlert.classList.add('d-none');

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    // Login successful, redirect to main application
                    window.location.href = '/'; 
                } else {
                    showAlert(authAlert, data.error || 'Login failed.', 'danger');
                }
            } catch (error) {
                showAlert(authAlert, 'Network error. Please try again.', 'danger');
            }
        });
        
        // Handle Registration Submission
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            regAlert.classList.add('d-none');
            
            const username = document.getElementById('reg-username').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    showAlert(regAlert, 'Registration successful! Redirecting...', 'success');
                    // Automatically log in and redirect
                    setTimeout(() => {
                        window.location.href = '/'; 
                    }, 1500);
                } else {
                    showAlert(regAlert, data.error || 'Registration failed.', 'danger');
                }
            } catch (error) {
                showAlert(regAlert, 'Network error. Please try again.', 'danger');
            }
        });

    });
</script>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>